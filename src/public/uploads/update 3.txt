

-- Tạo bảng Category
CREATE TABLE Category (
    id INT PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);

-- Tạo bảng Product
CREATE TABLE Product (
    id INT PRIMARY KEY,
    category_id INT,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    product_image VARCHAR(255),
    FOREIGN KEY (category_id) REFERENCES Category(id)
);

-- Tạo bảng Product_Item
CREATE TABLE Product_Item (
    id INT PRIMARY KEY,
    product_id INT,
    SKU VARCHAR(50) NOT NULL,
    qty_in_stock INT,
    product_image VARCHAR(255),
    price DECIMAL(10, 2),
    FOREIGN KEY (product_id) REFERENCES Product(id)
);

-- Tạo bảng Variation
CREATE TABLE Variation (
    id INT PRIMARY KEY,
    category_id INT,
    name VARCHAR(255) NOT NULL,
    FOREIGN KEY (category_id) REFERENCES Category(id)
);

-- Tạo bảng Variation_Option
CREATE TABLE Variation_Option (
    id INT PRIMARY KEY,
    variation_id INT,
    value VARCHAR(255) NOT NULL,
    FOREIGN KEY (variation_id) REFERENCES Variation(id)
);

-- Tạo bảng Product_Configuration
CREATE TABLE Product_Configuration (
    id INT PRIMARY KEY,
    product_item_id INT,
    variation_option_id INT,
    FOREIGN KEY (product_item_id) REFERENCES Product_Item(id),
    FOREIGN KEY (variation_option_id) REFERENCES Variation_Option(id)
);




-- Chèn dữ liệu vào bảng Category
INSERT INTO Category (id, name) VALUES
(1, 'Electronics'),
(2, 'Clothing');

-- Chèn dữ liệu vào bảng Product
INSERT INTO Product (id, category_id, name, description, product_image) VALUES
(1, 1, 'Laptop', 'Powerful laptop for work and play', 'laptop_image.jpg'),
(2, 2, 'T-shirt', 'Comfortable cotton T-shirt', 'tshirt_image.jpg'),
(3, 1, 'Custom Laptop', 'Custom laptop with multiple variations', 'custom_laptop_image.jpg'),
(4, 1, 'Custom Laptop 2', 'Custom laptop with multiple variations and 2 colors', 'custom_laptop_image_2.jpg');

-- Chèn dữ liệu vào bảng Product_Item
INSERT INTO Product_Item (id, product_id, SKU, qty_in_stock, product_image, price) VALUES
(1, 1, 'LT001', 10, 'laptop_item_image.jpg', 1200.00),
(2, 1, 'LT002', 5, 'laptop_item_image.jpg', 1500.00),
(3, 2, 'TS001', 20, 'tshirt_item_image.jpg', 25.00),
(4, 2, 'TS002', 15, 'tshirt_item_image.jpg', 30.00),
(5, 3, 'CLT001', 15, 'custom_laptop_item_image.jpg', 1800.00),
(6, 4, 'CLT002-Silver', 10, 'custom_laptop_item_image_silver.jpg', 1900.00),
(7, 4, 'CLT002-Black', 8, 'custom_laptop_item_image_black.jpg', 1950.00);

-- Chèn dữ liệu vào bảng Variation
INSERT INTO Variation (id, category_id, name) VALUES
(1, 1, 'Color'),
(2, 1, 'Storage Capacity'),
(3, 2, 'Size');

-- Chèn dữ liệu vào bảng Variation_Option
INSERT INTO Variation_Option (id, variation_id, value) VALUES
(1, 1, 'Silver'),
(2, 1, 'Black'),
(3, 2, '256GB'),
(4, 2, '512GB'),
(5, 3, 'Small'),
(6, 3, 'Medium'),
(7, 3, 'Large');

-- Chèn dữ liệu vào bảng Product_Configuration
INSERT INTO Product_Configuration (id, product_item_id, variation_option_id) VALUES
(1, 1, 1),
(2, 1, 3),
(3, 2, 2),
(4, 2, 4),
(5, 3, 5),
(6, 3, 7),
(7, 4, 6),
(8, 5, 1),
(9, 5, 3),
(10, 5, 6),
(11, 6, 1),
(12, 6, 3),
(13, 6, 6),
(14, 7, 2),
(15, 7, 3),
(16, 7, 6);


-- Lấy thông tin về Laptop màu Silver phiên bản 256GB
SELECT
    *
FROM
    Product P
JOIN Product_Item PI ON P.id = PI.product_id
JOIN Product_Configuration PC ON PI.id = PC.product_item_id
JOIN Variation_Option as V1 ON PC.variation_option_id = V1.id AND V1.variation_id = 1 -- Màu sắc
JOIN Variation_Option as V2 ON PC.variation_option_id = V2.id AND V2.variation_id = 2 -- Dung lượng lưu trữ
WHERE
    P.name = 'Laptop'
    AND V1.value = 'Silver'
    AND V2.value = '256GB';

SELECT
    *
FROM
    Product P
JOIN Product_Item PI ON P.id = PI.product_id
JOIN Product_Configuration PC ON PI.id = PC.product_item_id
JOIN Variation_Option as V2 ON PC.variation_option_id = V2.id AND V2.variation_id = 2
WHERE
    P.name = 'Laptop'
    AND V2.value = '256GB';


-- Lấy thông tin về tất cả các biến thể của sản phẩm "Laptop"
SELECT
    P.name AS product_name,
    PI.SKU,
    PI.qty_in_stock,
    PI.product_image AS item_image,
    PI.price AS item_price,
    V1.value AS color,
    V2.value AS storage_capacity
FROM
    Product P
JOIN Product_Item PI ON P.id = PI.product_id
JOIN Product_Configuration PC ON PI.id = PC.product_item_id
JOIN Variation_Option V1 ON PC.variation_option_id = V1.id AND V1.variation_id = 1 -- Màu sắc
JOIN Variation_Option V2 ON PC.variation_option_id = V2.id AND V2.variation_id = 2 -- Dung lượng lưu trữ
WHERE
    P.name = 'Laptop';


	--- 1 biến thể option

SELECT
    *
FROM
    Product
JOIN Product_Item ON Product.id = Product_Item.product_id
JOIN Product_Configuration ON Product_Item.id = Product_Configuration.product_item_id
JOIN Variation_Option AS Variation_Option_Color ON Product_Configuration.variation_option_id = Variation_Option_Color.id
JOIN Variation ON Variation_Option_Color.variation_id = Variation.id AND Variation.name = 'Size'

WHERE
    Product.name = 'T-shirt'
    AND Variation_Option_Color.value = 'Medium'



-- 2 biến thể option
SELECT
    *
FROM
    Product
JOIN Product_Item ON Product.id = Product_Item.product_id
JOIN Product_Configuration ON Product_Item.id = Product_Configuration.product_item_id
JOIN Variation_Option AS Variation_Option_Color ON Product_Configuration.variation_option_id = Variation_Option_Color.id
JOIN Variation ON Variation_Option_Color.variation_id = Variation.id AND Variation.name = 'Color'
LEFT JOIN (
    SELECT
        Product_Configuration.product_item_id AS storage_product_item_id,
        Variation_Option.value AS storage_capacity
    FROM
        Product_Configuration
    JOIN Variation_Option ON Product_Configuration.variation_option_id = Variation_Option.id
    JOIN Variation ON Variation_Option.variation_id = Variation.id AND Variation.name = 'Storage Capacity'
) AS Variation_Option_Storage ON Product_Item.id = Variation_Option_Storage.storage_product_item_id
WHERE
    Product.name = 'Laptop'
    AND Variation_Option_Color.value = 'Silver'
    AND Variation_Option_Storage.storage_capacity = '256GB';



--- 3 biến thể option
SELECT
    *
FROM
    Product
JOIN Product_Item ON Product.id = Product_Item.product_id
JOIN Product_Configuration ON Product_Item.id = Product_Configuration.product_item_id
JOIN Variation_Option AS Variation_Option_Color ON Product_Configuration.variation_option_id = Variation_Option_Color.id
JOIN Variation ON Variation_Option_Color.variation_id = Variation.id AND Variation.name = 'Color'
LEFT JOIN (
    SELECT
        Product_Configuration.product_item_id AS storage_product_item_id,
        Variation_Option.value AS storage_capacity
    FROM
        Product_Configuration
    JOIN Variation_Option ON Product_Configuration.variation_option_id = Variation_Option.id
    JOIN Variation ON Variation_Option.variation_id = Variation.id AND Variation.name = 'Storage Capacity'
) AS Variation_Option_Storage ON Product_Item.id = Variation_Option_Storage.storage_product_item_id

LEFT JOIN (
    SELECT
        Product_Configuration.product_item_id AS size_product_item_id,
        Variation_Option.value AS size
    FROM
        Product_Configuration
    JOIN Variation_Option ON Product_Configuration.variation_option_id = Variation_Option.id
    JOIN Variation ON Variation_Option.variation_id = Variation.id AND Variation.name = 'Size'
) AS Variation_Option_Size ON Product_Item.id = Variation_Option_Size.size_product_item_id

WHERE
    Product.name = 'Custom Laptop 2'
    AND Variation_Option_Color.value = 'Black'
    AND Variation_Option_Storage.storage_capacity = '256GB'
	AND Variation_Option_Size.size = 'Medium';



SELECT * FROM Product;
SELECT * FROM Product_Item;
SELECT * FROM Variation_Option;
SELECT * FROM Product_Configuration;



